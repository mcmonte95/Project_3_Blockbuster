<!DOCTYPE html>
<html lang="en">
<head>
  <style>
    body { margin: 0; }
    #time-log {
      position: absolute;
      font-size: 12px;
      font-family: sans-serif;
      padding: 5px;
      border-radius: 3px;
      background-color: rgba(200, 200, 200, 0.1);
      color: lavender;
      bottom: 10px;
      right: 10px;
    }
  </style>
  <script src="//unpkg.com/three"></script>
  <script src="//unpkg.com/satellite.js/dist/satellite.min.js"></script>
  <script src="//unpkg.com/globe.gl"></script>
</head>
<body>
  <div id="chart"></div>
  <div id="time-log"></div>

  <script>
    const EARTH_RADIUS_KM = 6371; // Earth's radius in kilometers
    const SAT_SIZE = 0.1; // Relative size of satellites
    const TIME_STEP = 60 * 1000; // Time step in milliseconds

    // Initialize the globe
    const world = Globe()
      (document.getElementById('chart'))
      .globeImageUrl('//unpkg.com/three-globe/example/img/earth-blue-marble.jpg')
      .objectLat('lat')
      .objectLng('lng')
      .objectAltitude('alt')
      .objectsTransitionDuration(0)
      .objectLabel('name');

    // Set the initial point of view
    setTimeout(() => world.pointOfView({ altitude: 3 }), 0);

    // Define satellite geometry and material
    const satGeometry = new THREE.SphereGeometry(SAT_SIZE, 8, 8);
    const satMaterial = new THREE.MeshBasicMaterial({ color: 'yellow', transparent: true, opacity: 0.8 });

    // Function to create a satellite mesh
    world.objectThreeObject(() => new THREE.Mesh(satGeometry, satMaterial));

    // Fetch satellite data
    fetch('http://127.0.0.1:5000/satLocations')
      .then(response => response.json())
      .then(satellites => {
        // Convert satellite data for globe.gl
        const satData = satellites.map(sat => ({
          lat: sat.Latitude,
          lng: sat.Longitude,
          alt: sat['Distance from Earth Surface (km)'] / EARTH_RADIUS_KM,
          name: sat['Satellite Name']
        }));

        // Time ticker to update the globe
        let time = new Date();
        (function frameTicker() {
          requestAnimationFrame(frameTicker);

          time = new Date(+time + TIME_STEP);
          document.getElementById('time-log').innerText = time.toISOString();

          // Update the globe with the satellite data
          world.objectsData(satData);
        })();
      });
  </script>
</body>
</html>
